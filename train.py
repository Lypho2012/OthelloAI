from YOURGROUP_ai import compute_utility
#from YOURGROUP_ai import final_board
from othello_game import AiPlayerInterface, OthelloGameManager, play_game
import sys
'''
win:
[-3, 0, 0, 4, 20, 6]
[-5, 0, 0, 4, 28, 5]
[-5, 0, 0, 7, 32, 6]
[-7, 0, 0, 11, 40, 6]
[-9, 0, 0, 10, 48, 6]
[-3, 0, 0, 4, 20, 6]
[-3, 0, 0, 7, 24, 5]
[-3, 0, 0, 5, 26, 10]
[-3, 0, 0, 14, 32, 4]
[-3, 0, 0, 4, 20, 6]
[-3, 0, 0, 7, 24, 5]
[-3, 0, 0, 5, 26, 10]
[-3, 0, 0, 14, 32, 4]
[-3, 0, 1, 13, 36, 5]
[-7, 0, 1, 6, 46, 10]
[-3, 0, 2, 6, 42, 10]
[-1, 0, 2, 15, 42, 10]
[3, 0, 3, 19, 38, 11]
[5, 0, 4, 14, 38, 16]
[9, 0, 5, 12, 33, 16]
[5, 0, 5, 15, 44, 13]
[5, 0, 6, 9, 48, 12]
[3, 0, 5, 16, 54, 10]
[3, 0, 5, 14, 57, 17]
[-1, 0, 3, 10, 66, 21]
[-7, 0, 3, 18, 82, 11]
[-9, 0, 4, 18, 90, 11]
[-11, 0, 4, 18, 97, 12]
[-9, 0, 3, 16, 95, 7]
[-11, 0, 4, 18, 103, 6]
[-13, 0, 3, 11, 109, 7]
[-18, 0, 4, 13, 123, 7]
[-17, 0, 3, 11, 121, 7]
[-19, 0, 7, 4, 131, 7]

'''
'''
weights:

0.25061830305722854 0.07066602213444696 0.33115314245953087 0.441210955718436 2.2535846718255717 0.4861002381381194

0.04176971717620476 0.011777670355741161 0.055192190409921814 0.073535159286406 0.3755974453042619 0.08101670635635323

0.006961619529367459 0.0019629450592901936 0.009198698401653636 0.012255859881067666 0.06259957421737698 0.013502784392725538

0.7558624056048067 -0.011756115704770214 -0.0835259950554098 -0.5691204414495191 -4.072034403544662 -0.3350118696035311

0.2500351622927324 0.041972685783521674 0.30390617861783675 0.4192040870580434 2.1089017271644037 0.4900490891246145

0.04167252704878874 0.006995447630586946 0.050651029769639457 0.06986734784300723 0.3514836211940673 0.08167484818743574

0.006945421174798123 0.0011659079384311575 0.00844183829493991 0.011644557973834539 0.058580603532344545 0.013612474697905956

0.7558597058790452 -0.011888955224913386 -0.08365213840652874 -0.5692223251007246 -4.072704231992168 -0.33499358788600103

0.2500347123384389 0.041950545863497814 0.3038851547259836 0.4191871064495092 2.1087900890898195 0.4900521360775361

0.19203682246171527 0.0059974179699493965 0.03704292602245017 -0.0528360548667501 -0.5366432047963956 -0.026614616033504984

0.0604726492705904 0.006953533181920425 0.040332504784526386 0.04863393883588927 0.1501323440855304 0.0633055783011205

0.08406509158009028 0.0011589221969867376 0.0023900428743446975 -0.05586329055653481 -0.383430394796128 -0.05334861322216261

0.014119453108750466 0.0002332039760954622 0.00069548125269799 -0.008805226331035558 -0.061223136047885124 -0.008357816279190525

0.0024618466968604996 7.891760594691626e-05 0.000413054315756872 -0.000962215626785687 -0.0075219262565113035 -0.000859350122028512

0.0005173428804505176 5.3280395238305556e-05 0.00036644626549690065 0.00033314362355214 0.0014318258539270932 0.00039968208354150737

0.0008073796957228189 8.880065873050925e-06 9.547745834670046e-06 -0.0005799188109572639 -0.0036995814759951955 -0.0003626870367770027

0.00024299637731240117 4.1505799379825195e-05 0.0002985851354328501 0.00040438352547341925 0.0020642063817559813 0.0004789261445957026

4.049939621873353e-05 6.9176332299708656e-06 4.9764189238808346e-05 6.739725424556987e-05 0.0003440343969593302 7.982102409928377e-05

0.0010138980651278016 -9.923239585895344e-06 -8.223345413425823e-05 -0.0013175066523773299 -0.0067116921600513255 -0.000961136909980375
'''

def mainT(res):
    weight_file = open("weight.txt","r+")
    weights = weight_file.readlines()

    original_weights = []
    for dynamic_weight in weights:
        original_weights.append(list(map(float, dynamic_weight.strip().split(" "))))
    new_weights_list = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]

    '''board_file = open("board.txt", "r+")
x
    board = []
    for line in board_file.readlines():
        #print(line[:-1].split(" "),file=sys.stderr)
        board.append(list(map(int,line[:-1].split(" "))))
    res = 1 if compute_utility(board,1) > 0 else -1'''

    file = open("data.txt","r+")
    lines = file.readlines()
    moves = 0
    original = original_weights[0]
    new_weights = new_weights_list[0]
    for line in lines:
        moves += 1
        if len(lines)//3 < moves < 2*len(lines)//3:
            original = original_weights[1]
            new_weights = new_weights_list[1]
        elif 2*len(lines)//3 < moves:
            original = original_weights[2]
            new_weights = new_weights_list[2]
        #print(line[1:-2].split(" "),file=sys.stderr)
        line = list(map(int, line[1:-2].split(", ")))
        s = sum(line)
        line = list(map(lambda x: x/s, line))
        print(original, file=sys.stderr)
        h = [line[x]*original[x] for x in range(6)]
        h = sum(h)
        if h > 0:
            h = 1
        else:
            h = -1
        print(h, file=sys.stderr)
        if h != res:
            for j in range(len(line)):
                new_weights[j] += line[j]*res*0.1

    weight_file.truncate(0)
    for n in range(3):
        new_weights = list(map(lambda x: x/6, new_weights_list[n]))
        original = original_weights[n]
        for i in range(6):
            new_weights[i] += original[i]
        #new_weights = list(map(lambda x: str(x/sum(new_weights)), new_weights))
        print(new_weights,file=sys.stderr)
        weight_file.writelines(" ".join(new_weights) + "\n")
   
    weight_file.close()

    file = file.truncate(0)
    file.close()


'''sys.argv.append("YOURGROUP_ai.py")

sys.argv.append("YOURGROUP_ai2.py")

player1 = AiPlayerInterface(sys.argv[1],1)
player2 = AiPlayerInterface(sys.argv[2],2)
game = OthelloGameManager(dimension=8)
p1score, p2score, timeout, color = play_game(game, player1, player2)
res = 1 if p1score - p2score > 0 else -1'''''
mainT(1)
